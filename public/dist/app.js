!function(){function e(o,t,n){function r(a,l){if(!t[a]){if(!o[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var B=t[a]={exports:{}};o[a][0].call(B.exports,function(e){var t=o[a][1][e];return r(t?t:e)},B,B.exports,e,o,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}return e}()({1:[function(e,o,t){var n=e("./util/color_hsl.js");o.exports=Game=function(e){this.canvas=document.getElementById(e),this.engine=new BABYLON.Engine(this.canvas,!0),this.map=null,this.socket=io();var o=this;window.addEventListener("resize",function(){o.engine.resize()}),this.canvas.oncontextmenu=function(e){e.preventDefault()},this.scene=this.createScene3(),this.socket.on("time",function(e){console.log("Server time: "+e)}),this.socket.on("load_map",function(e){console.log("Map recieved: "+e),o.map=e,o.loadMap()}),this.socket.emit("client_ready",(new Date).toDateString())},Game.prototype.createScene1=function(){var e=new BABYLON.Scene(this.engine);e.clearColor=new BABYLON.Color4(0,0,0,1);var o=new BABYLON.ArcRotateCamera("ArcRotateCamera",0,Math.PI/4,10,new BABYLON.Vector3(0,0,0),e);o.setTarget(BABYLON.Vector3.Zero()),o.attachControl(this.canvas,!1);var t=(new BABYLON.HemisphericLight("HemisphericLight",new BABYLON.Vector3(0,1,0),e),new BABYLON.StandardMaterial("Material",e));t.diffuseColor=new BABYLON.Color3(.5,0,0),t.specularColor=new BABYLON.Color3(.5,0,0);var n=BABYLON.MeshBuilder.CreateSphere("Sphere",{segments:16,diameter:2},e);n.material=t,n.position.y=1;var r=new BABYLON.StandardMaterial("Material",e);r.diffuseColor=new BABYLON.Color3(0,0,.5),r.specularColor=new BABYLON.Color3(0,0,.5),r.ambientColor=new BABYLON.Color3(0,0,.5),BABYLON.MeshBuilder.CreateGround("Ground",{width:6,height:6,subdivisions:2},e).material=r,this.createUI(e);var i=BABYLON.Animation.CreateAndStartAnimation("SphereScale",n,"scaling",30,90,new BABYLON.Vector3(1,1,1),new BABYLON.Vector3(2,2,2));return i.pause(),window.addEventListener("click",function(){var o=e.pick(e.pointerX,e.pointerY);o.hit&&"Sphere"==o.pickedMesh.name&&i.restart()}),e},Game.prototype.createScene2=function(){var e=new BABYLON.Scene(this.engine);e.clearColor=new BABYLON.Color4(.25,.25,.25,1);var o=new BABYLON.ArcRotateCamera("ArcRotateCamera",0,Math.PI/4,10,new BABYLON.Vector3(0,0,0),e);o.setTarget(BABYLON.Vector3.Zero()),o.attachControl(this.canvas,!1);var t=(new BABYLON.PointLight("PointLight",new BABYLON.Vector3(5,10,2),e),new BABYLON.StandardMaterial("Material",e));t.diffuseColor=new BABYLON.Color3(0,.5,0),t.specularColor=new BABYLON.Color3(0,.5,0);var n=BABYLON.MeshBuilder.CreateBox("Box",{size:2},e);n.material=t,n.position.y=1;var r=new BABYLON.StandardMaterial("Material",e);r.diffuseColor=new BABYLON.Color3(0,0,.5),r.specularColor=new BABYLON.Color3(0,0,.5),r.ambientColor=new BABYLON.Color3(0,0,.5),BABYLON.MeshBuilder.CreateGround("Ground",{width:6,height:6,subdivisions:2},e).material=r,this.createUI(e);var i=[];i.push({frame:0,value:new BABYLON.Vector3(1,1,1)}),i.push({frame:30,value:new BABYLON.Vector3(1.2,1.2,1.2)}),i.push({frame:60,value:new BABYLON.Vector3(1,1,1)});var a=new BABYLON.Animation("myAnimation","scaling",30,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);a.setKeys(i);var l=new BABYLON.QuadraticEase;l.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),a.setEasingFunction(l),n.animations=[],n.animations.push(a);var s=e.beginAnimation(n,0,60,!0);return window.addEventListener("click",function(){var o=e.pick(e.pointerX,e.pointerY);o.hit&&"Box"==o.pickedMesh.name&&s.reset()}),e},Game.prototype.createScene3=function(){var e=new BABYLON.Scene(this.engine);return e.clearColor=new BABYLON.Color4(0,0,0,1),new BABYLON.ArcRotateCamera("ArcRotateCamera",.5*-Math.PI,.6*Math.PI,150,new BABYLON.Vector3(110,50,0),e).attachControl(this.canvas,!1),e},Game.prototype.loadMap=function(){var e=this;for(var o of this.map.regions)for(var t of o.territories){var r=[],i=[];for(var a of t.borders)r.push(new BABYLON.Vector3(a.x,a.y,0)),i.push(new BABYLON.Vector3(a.x,0,a.y));r.push(new BABYLON.Vector3(t.borders[0].x,t.borders[0].y,0)),i.push(new BABYLON.Vector3(t.borders[0].x,0,t.borders[0].y));var l=new BABYLON.GridMaterial(t.id+"_ground_material",this.scene);l.lineColor=new n(o.color.h,o.color.s,o.color.l).toColor3(),l.majorUnitFrequency=0;var s=new BABYLON.StandardMaterial(t.id+"_material",this.scene);s.emissiveColor=new n(o.color.h,o.color.s,o.color.l).toColor3();var c=BABYLON.MeshBuilder.CreatePolygon(t.id+"_polygon",{shape:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);c.material=l,c.rotate(BABYLON.Axis.X,-Math.PI/2,BABYLON.Space.WORLD);var B=BABYLON.MeshBuilder.CreateLines(t.id+"_lines",{points:r,updatable:!1,instance:null},this.scene);B.color=new n(o.color.h,o.color.s,.5).toColor3(),c.actionManager=new BABYLON.ActionManager(this.scene),c.actionManager.registerAction(new BABYLON.InterpolateValueAction(BABYLON.ActionManager.OnPointerOverTrigger,c.material,"lineColor",new n(o.color.h,o.color.s,.5).toColor3(),100)),c.actionManager.registerAction(new BABYLON.InterpolateValueAction(BABYLON.ActionManager.OnPointerOutTrigger,c.material,"lineColor",new n(o.color.h,o.color.s,o.color.l).toColor3(),100)),c.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(o){if(console.log("execute action"),o.meshUnderPointer){var t=o.meshUnderPointer;e.onTerrytoryClicked(t)}}))}},Game.prototype.onTerrytoryClicked=function(e){var o=e.name.replace("_polygon","");e.material.lineColor=new n(.6,.9,.3).toColor3();for(var t of this.map.regions)for(var r of t.territories)if(r.id==o&&r.neighbours)for(var i of r.neighbours){var a=this.scene.getMeshByName(i.id+"_polygon");a.material.lineColor=new n(0,.9,.3).toColor3()}},Game.prototype.createUI=function(e){var o=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),t=new BABYLON.Sound("buttonHoverSound","audio/beep-29.wav",e),n=new BABYLON.Sound("buttonClickSound","audio/button-35.wav",e),r=this,i=BABYLON.GUI.Button.CreateSimpleButton("btnScene1","S1");i.width="100px",i.height="40px",i.color="white",i.background="grey",i.top="20px",i.left="20px",i.fontFamily="Share Tech Mono",i.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,i.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,i.onPointerUpObservable.add(function(){n.play();window.setTimeout(function(){r.scene.dispose(),r.scene=r.createScene1()},200)}),i.onPointerEnterObservable.add(function(){t.play()}),o.addControl(i);var a=BABYLON.GUI.Button.CreateSimpleButton("btnScene2","S2");a.width="100px",a.height="40px",a.color="white",a.background="grey",a.top="20px",a.left="140px",a.fontFamily="Share Tech Mono",a.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,a.onPointerUpObservable.add(function(){n.play();window.setTimeout(function(){r.scene.dispose(),r.scene=r.createScene2()},200)}),a.onPointerEnterObservable.add(function(){t.play()}),o.addControl(a);var l=BABYLON.GUI.Button.CreateSimpleButton("btnScene3","S3");l.width="100px",l.height="40px",l.color="white",l.background="grey",l.top="20px",l.left="260px",l.fontFamily="Share Tech Mono",l.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,l.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,l.onPointerUpObservable.add(function(){n.play();window.setTimeout(function(){r.scene.dispose(),r.scene=r.createScene3()},200)}),l.onPointerEnterObservable.add(function(){t.play()}),o.addControl(l);var s=BABYLON.GUI.Button.CreateSimpleButton("btnDebug","Debug");s.width="100px",s.height="40px",s.color="white",s.background="grey",s.top="-20px",s.left="20px",s.fontFamily="Share Tech Mono",s.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,s.onPointerUpObservable.add(function(){n.play(),r.scene.debugLayer.isVisible()?r.scene.debugLayer.hide():r.scene.debugLayer.show()}),s.onPointerEnterObservable.add(function(){t.play()}),o.addControl(s)},Game.prototype.run=function(){var e=this;this.engine.runRenderLoop(function(){e.scene.render()})};var r=new Game("renderCanvas");console.log("Game object created"),r.run(),console.log("Run started")},{"./util/color_hsl.js":2}],2:[function(e,o,t){o.exports=ColorHSL=function(e,o,t){this.h=e,this.s=o,this.l=t},ColorHSL.prototype.toColor3=function(){var e,o,t;if(0==this.s)e=o=t=this.l;else{var n=function(e,o,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(o-e)*t:t<.5?o:t<2/3?e+(o-e)*(2/3-t)*6:e},r=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,i=2*this.l-r;e=n(i,r,this.h+1/3),o=n(i,r,this.h),t=n(i,r,this.h-1/3)}return new BABYLON.Color3(e,o,t)},ColorHSL.prototype.fromColor3=function(e,o,t){var n=Math.max(e,o,t),r=Math.min(e,o,t);if(this.h=(n+r)/2,this.s=(n+r)/2,this.l=(n+r)/2,n==r)this.h=this.s=0;else{var i=n-r;switch(this.s=this.l>.5?i/(2-n-r):i/(n+r),n){case e:this.h=(o-t)/i+(o<t?6:0);break;case o:this.h=(t-e)/i+2;break;case t:this.h=(e-o)/i+4}this.h/=6}}},{}]},{},[1]);