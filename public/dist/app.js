!function(){function t(e,n,i){function s(a,r){if(!n[a]){if(!e[a]){var h="function"==typeof require&&require;if(!r&&h)return h(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return s(n?n:t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}return t}()({1:[function(t,e,n){const i=t("./splash.js"),s=t("./menu.js"),o=t("./match.js");class a{constructor(t){this.canvas=document.getElementById(t),this.engine=new BABYLON.Engine(this.canvas,!0),this.socket=io(),this.splash=new i(this.canvas,this.engine,this.socket,this),this.menu=new s(this.canvas,this.engine,this.socket,this),this.match=new o(this.canvas,this.engine,this.socket),window.addEventListener("resize",()=>{this.engine.resize()}),this.canvas.oncontextmenu=(t=>{t.preventDefault()}),document.addEventListener("keydown",t=>{"KeyF"==t.code&&this.toggleFullScreen()},!1),document.addEventListener("keydown",t=>{"KeyD"==t.code&&this.toggleDebugLayer()},!1);let e=new URL(window.location.href);var n=e.searchParams.get("scene");this.scene=n&&"match"==n?this.match.createMatchScene():n&&"menu"==n?this.menu.createMainMenuScene():this.splash.createSplashScene()}run(){this.engine.runRenderLoop(()=>{this.scene.render()})}menuAction(){this.scene.dispose(),this.scene=this.menu.createMainMenuScene()}newGameAction(){this.scene.dispose(),this.scene=this.match.createMatchScene()}toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}toggleDebugLayer(){this.scene.debugLayer.isVisible()?this.scene.debugLayer.hide():this.scene.debugLayer.show()}}e.exports=a,new a("renderCanvas").run()},{"./match.js":2,"./menu.js":3,"./splash.js":4}],2:[function(t,e,n){const i=t("./util/color_hsl.js");class s{constructor(t,e,n){this.canvas=t,this.engine=e,this.socket=n,this.scene=null,this.camera=null,this.advancedTexture=null,this.hoverText=null,this.materials=[],this.map=null,this.socket.on("load_map",t=>{this.map=t,this.loadMap()}),this.socket.on("chat_broadcast_message",t=>{console.log("CHAT >> "+t)})}createMatchScene(){this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=new i(.6,.6,.1).toColor4(),this.scene.defaultCursor="url('/img/cursors/green_select.cur'), auto ",this.scene.hoverCursor="url('/img/cursors/yellow_select.cur'), auto ";let t=.5*-Math.PI,e=.5*Math.PI,n=new BABYLON.Vector3(110,50,0);return this.camera=new BABYLON.ArcRotateCamera("matchCamera",t,e+.5,150,n,this.scene),this.camera.attachControl(this.canvas,!1),this.camera.lowerRadiusLimit=50,this.camera.upperRadiusLimit=300,this.camera.lowerAlphaLimit=t-.5,this.camera.upperAlphaLimit=t+.5,this.camera.lowerBetaLimit=e-.5,this.camera.upperBetaLimit=e+.5,this.camera.inputs.remove(this.camera.inputs.attached.keyboard),this.camera.inputs.remove(this.camera.inputs.attached.pointers),this.createUI(this.scene),this.socket.emit("client_ready"),this.scene}loadMap(){for(let t of this.map.regions)for(let e of t.territories){let t=[],n=[];for(let i of e.borders)t.push(new BABYLON.Vector3(i.x,i.y,0)),n.push(new BABYLON.Vector3(i.x,0,i.y));t.push(new BABYLON.Vector3(e.borders[0].x,e.borders[0].y,0)),n.push(new BABYLON.Vector3(e.borders[0].x,0,e.borders[0].y));let s=new i(0,0,.3).toColor3(),o=new i(0,0,.5).toColor3(),a=new BABYLON.GridMaterial(e.id+"_grid_material",this.scene);a.lineColor=s,a.majorUnitFrequency=0,this.materials.push(a);let r=new BABYLON.StandardMaterial(e.id+"_material",this.scene);r.emissiveColor=s,this.materials.push(r);let h=BABYLON.MeshBuilder.CreatePolygon(e.id+"_polygon",{shape:n,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);h.material=a,h.rotate(BABYLON.Axis.X,-Math.PI/2,BABYLON.Space.WORLD);let c=BABYLON.MeshBuilder.CreateLines(e.id+"_lines",{points:t,updatable:!1,instance:null},this.scene);c.color=o,h.actionManager=new BABYLON.ActionManager(this.scene),h.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,t=>{t.meshUnderPointer.material=this.getMaterialByName(t.meshUnderPointer.name.replace("_polygon","_material")),this.hoverText.text=t.meshUnderPointer.name.replace("_polygon",""),this.hoverText.alpha=1})),h.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,t=>{t.meshUnderPointer.material=this.getMaterialByName(t.meshUnderPointer.name.replace("_polygon","_grid_material")),this.hoverText.alpha=0,this.hoverText.text=""})),h.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,t=>{if(t.meshUnderPointer){let e=t.meshUnderPointer;this.onTerrytoryClicked(e)}}))}this.drawConnections()}drawConnections(){for(let t of this.map.connections)for(let e=1;e<t.points.length;e++){let n=t.points[e-1],i=t.points[e],s=new BABYLON.Vector3(n.x,n.y,.2),o=new BABYLON.Vector3(i.x,i.y,.2),a=o.subtract(s).normalize(),r=s.add(a);this.drawConnectionDot(s),this.drawConnectionDot(r);let h=o.subtract(r).length();for(;h>a.length();)r=r.add(a),this.drawConnectionDot(r),h=o.subtract(r).length()}}drawConnectionDot(t){let e=new BABYLON.StandardMaterial("disc_material",this.scene);e.emissiveColor=new i(0,0,.5).toColor3();let n=BABYLON.MeshBuilder.CreateDisc("disc",{radius:.25,arc:1,tessellation:50,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);n.position=t.clone(),n.material=e}onTerrytoryClicked(t){let e=t.name.replace("_polygon","");t.material.lineColor=new i(0,0,.5).toColor3();for(let t of this.map.regions)for(let n of t.territories)if(n.id==e&&n.neighbours)for(let t of n.neighbours){let e=this.scene.getMeshByName(t.id+"_polygon");e.material.lineColor=new i(0,0,.7).toColor3()}this.socket.emit("chat_send_message",e),e.startsWith("a")&&this.socket.emit("chat_client_rename","player_"+e)}getMaterialByName(t){for(let e of this.materials)if(e.name==t)return e}createUI(t){this.advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");let e=new BABYLON.Sound("buttonHoverSound","audio/beep-29.wav",t),n=new BABYLON.Sound("buttonClickSound","audio/button-35.wav",t),s=BABYLON.GUI.Button.CreateSimpleButton("btnDebug","Debug");s.width="100px",s.height="40px",s.color="white",s.background="grey",s.top="-20px",s.left="20px",s.fontFamily="Share Tech Mono",s.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,s.onPointerUpObservable.add(()=>{n.play(),this.scene.debugLayer.isVisible()?this.scene.debugLayer.hide():this.scene.debugLayer.show()}),s.onPointerEnterObservable.add(()=>{e.play()}),this.hoverText=new BABYLON.GUI.TextBlock,this.hoverText.width="400px",this.hoverText.height="40px",this.hoverText.text="",this.hoverText.fontFamily="Share Tech Mono",this.hoverText.color=new i(0,0,.7).toRGBString(),this.hoverText.alpha=0,this.hoverText.fontSize=14,this.hoverText.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.hoverText.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.hoverText.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.hoverText.textVerticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.advancedTexture.addControl(this.hoverText),window.addEventListener("mousemove",()=>{this.hoverText.left=this.scene.pointerX+20,this.hoverText.top=this.scene.pointerY+20})}}e.exports=s},{"./util/color_hsl.js":5}],3:[function(t,e,n){const i=t("./util/color_hsl.js");class s{constructor(t,e,n,i){this.canvas=t,this.engine=e,this.socket=n,this.actionsHandler=i,this.scene=null,this.camera=null,this.advancedTexture=null,this.menuMusic=null,this.buttonHoverSound=null,this.buttonClickSound=null,this.txtGameTitle=null,this.btnCreateMatch=null,this.btnJoinMatch=null}createMainMenuScene(){return this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=new BABYLON.Color4(0,0,0,1),this.scene.defaultCursor="url('/img/cursors/green_select.cur'), auto ",this.scene.hoverCursor="url('/img/cursors/yellow_select.cur'), auto ",this.camera=new BABYLON.ArcRotateCamera("mainMenuCamera",.5*-Math.PI,.6*Math.PI,150,new BABYLON.Vector3(110,50,0),this.scene),this.camera.attachControl(this.canvas,!1),this.scene.activeCamera=this.camera,this.advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),this.menuMusic=new BABYLON.Sound("buttonHoverSound","audio/menu.mp3",this.scene,null,{autoplay:!0,loop:!0}),this.buttonHoverSound=new BABYLON.Sound("buttonHoverSound","audio/beep-29.wav",this.scene),this.buttonClickSound=new BABYLON.Sound("buttonClickSound","audio/button-35.wav",this.scene),this.createTitle(),this.createNewGameButton(),this.createJoinGameButton(),this.scene}createTitle(){this.txtGameTitle=new BABYLON.GUI.TextBlock,this.txtGameTitle.width="400px",this.txtGameTitle.height="40px",this.txtGameTitle.text="WAR II ONLINE",this.txtGameTitle.fontFamily="Share Tech Mono",this.txtGameTitle.color=new i(0,0,.5).toRGBString(),this.txtGameTitle.alpha=0,this.txtGameTitle.fontSize=48,this.advancedTexture.addControl(this.txtGameTitle);let t=[];t.push({frame:0,value:0}),t.push({frame:30,value:1});let e=new BABYLON.Animation("titleAnimation","alpha",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT);e.setKeys(t);let n=new BABYLON.QuadraticEase;n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),e.setEasingFunction(n),this.txtGameTitle.animations=[],this.txtGameTitle.animations.push(e),this.scene.beginAnimation(this.txtGameTitle,0,30,!1,1,()=>{this.scene.beginAnimation(this.btnCreateMatch,0,30,!1,1,()=>{this.scene.beginAnimation(this.btnJoinMatch,0,30,!1,1,()=>{this.enableButtonInteractions()})})})}createNewGameButton(){this.btnCreateMatch=new BABYLON.GUI.TextBlock,this.btnCreateMatch.text="CREATE NEW MATCH",this.btnCreateMatch.width="200px",this.btnCreateMatch.height="30px",this.btnCreateMatch.fontFamily="Share Tech Mono",this.btnCreateMatch.color=new i(0,0,.5).toRGBString(),this.btnCreateMatch.alpha=0,this.btnCreateMatch.fontSize=16,this.btnCreateMatch.top="100px";let t=[];t.push({frame:0,value:0}),t.push({frame:30,value:1});let e=new BABYLON.Animation("newGameAnimation","alpha",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT);e.setKeys(t);let n=new BABYLON.QuadraticEase;n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),e.setEasingFunction(n),this.btnCreateMatch.animations=[],this.btnCreateMatch.animations.push(e),this.advancedTexture.addControl(this.btnCreateMatch)}createJoinGameButton(){this.btnJoinMatch=new BABYLON.GUI.TextBlock,this.btnJoinMatch.text="JOIN EXISTING MATCH",this.btnJoinMatch.width="200px",this.btnJoinMatch.height="30px",this.btnJoinMatch.fontFamily="Share Tech Mono",this.btnJoinMatch.color=new i(0,0,.5).toRGBString(),this.btnJoinMatch.alpha=0,this.btnJoinMatch.fontSize=16,this.btnJoinMatch.top="140px";let t=[];t.push({frame:0,value:0}),t.push({frame:30,value:1});let e=new BABYLON.Animation("newGameAnimation","alpha",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT);e.setKeys(t);let n=new BABYLON.QuadraticEase;n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),e.setEasingFunction(n),this.btnJoinMatch.animations=[],this.btnJoinMatch.animations.push(e),this.advancedTexture.addControl(this.btnJoinMatch)}enableButtonInteractions(){this.btnCreateMatch.onPointerEnterObservable.add(()=>{this.buttonHoverSound.play(),this.btnCreateMatch.color=new i(0,0,.7).toRGBString(),this.btnCreateMatch.text="> CREATE NEW MATCH <"}),this.btnCreateMatch.onPointerOutObservable.add(()=>{this.btnCreateMatch.color=new i(0,0,.5).toRGBString(),this.btnCreateMatch.text="CREATE NEW MATCH"}),this.btnCreateMatch.onPointerUpObservable.add(()=>{this.menuMusic.pause(),this.buttonClickSound.play(),window.setTimeout(()=>{this.actionsHandler.newGameAction()},200)}),this.btnJoinMatch.onPointerEnterObservable.add(()=>{this.buttonHoverSound.play(),this.btnJoinMatch.color=new i(0,0,.7).toRGBString(),this.btnJoinMatch.text="> JOIN EXISTING MATCH <"}),this.btnJoinMatch.onPointerOutObservable.add(()=>{this.btnJoinMatch.color=new i(0,0,.5).toRGBString(),this.btnJoinMatch.text="JOIN EXISTING MATCH"}),this.btnJoinMatch.onPointerUpObservable.add(()=>{this.buttonClickSound.play()})}}e.exports=s},{"./util/color_hsl.js":5}],4:[function(t,e,n){t("./util/color_hsl.js");class i{constructor(t,e,n,i){this.canvas=t,this.engine=e,this.socket=n,this.actionsHandler=i,this.scene=null,this.camera=null,this.advancedTexture=null,this.splashSound=null,this.txtSplash=null,this.imgLogo=null}createSplashScene(){this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=new BABYLON.Color4(0,0,0,1),this.scene.defaultCursor="url('/img/cursors/green_select.cur'), auto ",this.scene.hoverCursor="url('/img/cursors/yellow_select.cur'), auto ",this.camera=new BABYLON.ArcRotateCamera("splashCamera",.5*-Math.PI,.6*Math.PI,150,new BABYLON.Vector3(110,50,0),this.scene),this.camera.attachControl(this.canvas,!1),this.scene.activeCamera=this.camera,this.advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),this.splashSound=new BABYLON.Sound("splashSound","audio/intro.mp3",this.scene,null,{autoplay:!0}),this.imgLogo=new BABYLON.GUI.Image("imgLogo","img/logo_boxingjellyfish.png"),this.imgLogo.alpha=0,this.imgLogo.width="256px",this.imgLogo.height="256px",this.advancedTexture.addControl(this.imgLogo);let t=[];t.push({frame:0,value:0}),t.push({frame:30,value:1}),t.push({frame:90,value:1}),t.push({frame:120,value:0});let e=new BABYLON.Animation("logoAnimation","alpha",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT);e.setKeys(t);let n=new BABYLON.QuadraticEase;return n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),e.setEasingFunction(n),this.imgLogo.animations=[],this.imgLogo.animations.push(e),this.scene.beginAnimation(this.imgLogo,0,120,!1,1,()=>{window.setTimeout(()=>{this.actionsHandler.menuAction()},50)}),this.scene}}e.exports=i},{"./util/color_hsl.js":5}],5:[function(t,e,n){class i{constructor(t,e,n){this.h=t,this.s=e,this.l=n}toColor3(){let t,e,n;if(0==this.s)t=e=n=this.l;else{let i=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,o=2*this.l-s;t=i(o,s,this.h+1/3),e=i(o,s,this.h),n=i(o,s,this.h-1/3)}return new BABYLON.Color3(t,e,n)}fromColor3(t,e,n){let i=Math.max(t,e,n),s=Math.min(t,e,n);if(this.h=(i+s)/2,this.s=(i+s)/2,this.l=(i+s)/2,i==s)this.h=this.s=0;else{let o=i-s;switch(this.s=this.l>.5?o/(2-i-s):o/(i+s),i){case t:this.h=(e-n)/o+(e<n?6:0);break;case e:this.h=(n-t)/o+2;break;case n:this.h=(t-e)/o+4}this.h/=6}}toRGBString(){let t=this.toColor3();return"rgb("+Math.floor(255*t.r)+","+Math.floor(255*t.g)+","+Math.floor(255*t.b)+")"}toColor4(t=1){let e=this.toColor3();return new BABYLON.Color4(e.r,e.g,e.b,t)}}e.exports=i},{}]},{},[1]);